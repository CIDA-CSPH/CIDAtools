<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>RStudio/JupyterLab on the CSPH Biostats Cluster • CIDAtools</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="RStudio/JupyterLab on the CSPH Biostats Cluster">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CIDAtools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/alpine.html">Alpine HPC</a></li>
    <li><a class="dropdown-item" href="../articles/CIDA_BIOS_Cluster_Interactive_IDEs.html">RStudio/JupyterLab on the CSPH Biostats Cluster</a></li>
    <li><a class="dropdown-item" href="../articles/CIDA_BIOS_Cluster.html">Computing on the CSPH Biostats Cluster</a></li>
    <li><a class="dropdown-item" href="../articles/CIDA_computing_resources.html">CIDA Computing Resources</a></li>
    <li><a class="dropdown-item" href="../articles/coding_guidelines.html">CIDA-coding-guidelines</a></li>
    <li><a class="dropdown-item" href="../articles/cron-jobs.html">Cron Jobs</a></li>
    <li><a class="dropdown-item" href="../articles/data_storage.html">CIDA-data-storage-guidelines</a></li>
    <li><a class="dropdown-item" href="../articles/git.html">Tracking code in Git/GitHub</a></li>
    <li><a class="dropdown-item" href="../articles/sas-macros.html">CIDA SAS Macros</a></li>
    <li><a class="dropdown-item" href="../articles/tabling_packages.html">Tabling Packages</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>RStudio/JupyterLab on the CSPH Biostats Cluster</h1>
                        <h4 data-toc-skip class="author">Research Tools
Committee</h4>
            
            <h4 data-toc-skip class="date">Last Updated: 2025-06-03</h4>
      

      <div class="d-none name"><code>CIDA_BIOS_Cluster_Interactive_IDEs.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="a--introduction">A. Introduction<a class="anchor" aria-label="anchor" href="#a--introduction"></a>
</h2>
<p>This document will guide you through running interactive RStudio
(and/or JupyterLab) sessions on the Biostats cluster.</p>
<p>Once configured, you’ll be able to easily submit RStudio/JupyterLab
SLURM jobs, and access them through your browser.</p>
<p>We’ll cover:</p>
<ol style="list-style-type: decimal">
<li>
<a href="#first-time-setup">First-time Setup</a> - Some one-time,
prerequisite configuration steps on your local computer to enable
connections to RStudio and JupyterLab.</li>
<li>
<a href="#launching-an-rstudio-session">Launching RStudio
Sessions</a> - How to launch an RStudio session on the cluster and
connect from your browser.</li>
<li>
<a href="#launching-a-jupyterlab-session">Launching JupyterLab
Sessions</a> - How to launch a JupyterLab session on the cluster and
connect from your browser.</li>
<li>
<a href="#quit-the-rstudiojupyterlab-session">Quitting
RStudio/JupyterLab Sessions</a> - How to quit an RStudio/JupterLab
session.</li>
<li>
<a href="#optional-additional-options-and-job-customization">(Optional)
Additional Options</a> - Some additional options and information which
may be useful.</li>
</ol>
<p>If you’ve never used the <code>csphbiostats</code> cluster before,
you’ll need to request an account. Information on how to access the
cluster is available in the <a href="https://cida-csph.github.io/CIDAtools/articles/CIDA_BIOS_Cluster.html#accessing-the-csph-biostats-cluster">Accessing
the CSPH Biostats Cluster</a> section of the main Biostats HPC
article.</p>
<p>If you previously followed this guide to set up RStudio/JupyterLab
and just need a refresher on how to launch an RStudio/JupyterLab job,
check out the <a href="#quickstart-for-returning-users">Quickstart</a>
section.</p>
<div class="section level3">
<h3 id="a1--motivation">A1. Motivation<a class="anchor" aria-label="anchor" href="#a1--motivation"></a>
</h3>
<p>Using RStudio/JupyterLab on the <code>csphbiostats</code> cluster
allows you to:</p>
<ul>
<li>Use the cluster’s significant <a href="https://cida-csph.github.io/CIDAtools/articles/CIDA_BIOS_Cluster.html#csph-biostats-hpc-cluster">computational
resources</a> to work with larger datasets than would be possible on a
local machine, while coding interactively in a familiar
environment.</li>
<li>Offload time consuming analysis tasks from your local computer to
the cluster (your RStudio/JupyterLab job will keep running on the
cluster, even if you log out!)</li>
<li>Running RMarkdown/Quarto/Jupyter Notebooks and generating reports
directly from the cluster.</li>
<li>Generate and view visualizations in real-time.</li>
</ul>
</div>
<div class="section level3">
<h3 id="a2--capabilities">A2. Capabilities<a class="anchor" aria-label="anchor" href="#a2--capabilities"></a>
</h3>
<p>The RStudio container runs R 4.5.0, and supports the usual RStudio
functions including RMarkdown/Quartio notebooks, interactive plotting,
etc. For convenience, the RStudio container has a variety of commonly
used packages pre-installed, including the <code>tidyverse</code>
family, and also packages many system libraries needed for compiling R
packages from source.</p>
<p>The JupyterLab container supports running Jupyter Notebooks
(<code>.ipynb</code>), and supports all JupyterLab functions. By
default, the JupyterLab container has the following kernels
installed:</p>
<ul>
<li>Python 3.13</li>
<li>R 4.5.0</li>
<li>Julia 1.11.5</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="b--questions-comments-issues">B. Questions, Comments, Issues<a class="anchor" aria-label="anchor" href="#b--questions-comments-issues"></a>
</h2>
<p>This project is <a href="https://github.com/CIDA-CSPH/Biostats-Cluster-Tools" class="external-link">hosted on
GitHub here</a>.</p>
<p>If you have questions, encounter difficulties, or have suggestions
for improvements, feel free to either <a href="https://github.com/CIDA-CSPH/Biostats-Cluster-Tools/issues" class="external-link">open
an issue on GitHub</a> or
<a href="mailto:andrew.2.hill@cuanschutz.edu">email me directly</a>.</p>
</div>
<div class="section level2">
<h2 id="first-time-setup">1. First-time Setup<a class="anchor" aria-label="anchor" href="#first-time-setup"></a>
</h2>
<p>Although the RStudio/JupyterLab instance will run on an HPC compute
node, you’ll log in to the cluster normally (via SSH), and access then
RStudio/JupyterLab interface through your local browser.</p>
<p>In order for this to work correctly, we need to configure a few SSH
options when logging in to the cluster. These SSH options should only
need to be configured once.</p>
<div class="section level3">
<h3 id="a--locate-ssh-config-file">1A. Locate SSH Config File<a class="anchor" aria-label="anchor" href="#a--locate-ssh-config-file"></a>
</h3>
<p>The simplest way to configure SSH connections is to use the SSH
<code>config</code> file, which allows us to define persistent options
that will be used each time we log in to the cluster (rather than having
to remember which parameters to pass on the command line each time).</p>
<p>On Mac/Unix-like systems, this file is located at
<code>~/.ssh/config</code>, and on Windows it is located at
<code>C:/Users/&lt;username&gt;/.ssh/config</code>.</p>
<p>If you don’t see a file named <code>config</code> in that location
that’s OK, just create it with your text editor of choice.</p>
<p><strong>Note:</strong> Some GUI clients (like PuTTY on Windows) do
not support port forwarding to Unix sockets (requried functionality to
use RStudio/JupyterLab on the cluster). However, modern command-line
versions of SSH on Mac and Windows do support this.</p>
</div>
<div class="section level3">
<h3 id="b--add-ssh-configuration-options">1B. Add SSH Configuration options<a class="anchor" aria-label="anchor" href="#b--add-ssh-configuration-options"></a>
</h3>
<p>Open up the <code>config</code> file in your text editor of choice.
If you had a pre-existing <code>config</code> file, check if you have an
entry with <code>Host csphbiostats.ucdenver.pvt</code> or
<code>HostName csphbiostats.ucdenver.pvt</code>. If you already have an
entry you can modify it instead of creating a new entry.</p>
<p><strong>IMPORTANT:</strong> If you have an existing
<code>config</code>, and there is an entry that begins with
<code>Host *</code>, you should add the new configuration we make
<strong>above</strong> the existing <code>Host *</code> section to
ensure that our new configuration will take precedence.</p>
<div class="section level4">
<h4 id="b-1-ssh-config-template">1B.1 SSH Config Template<a class="anchor" aria-label="anchor" href="#b-1-ssh-config-template"></a>
</h4>
<p>Configure your entry to look something like the below entry template,
replacing the three highlighted <code>your_username</code> placeholders
with the username you use to log into the cluster with SSH:</p>
<div class="sourceCode">
<pre><code>Host biostats
    HostName csphbiostats.ucdenver.pvt
    User <mark>your_username</mark>
    Port 22
    LocalForward 8895 /tmp/jupyter-<mark>your_username</mark>.sock
    LocalForward 8896 /tmp/rstudio-<mark>your-username</mark>.sock
</code></pre>
</div>
</div>
<div class="section level4">
<h4 id="b-2-fully-configured-ssh-config-example">1B.2 Fully-configured SSH Config Example<a class="anchor" aria-label="anchor" href="#b-2-fully-configured-ssh-config-example"></a>
</h4>
<p>As an example, a fully-configured entry looks like this:</p>
<pre><code>Host biostats
    HostName csphbiostats.ucdenver.pvt
    User coopdale
    Port 22
    LocalForward 8895 /tmp/jupyter-coopdale.sock
    LocalForward 8896 /tmp/rstudio-coopdale.sock</code></pre>
<p>The three <code>your_username</code> placeholders from the template
have been replaced with the user’s username <code>coopdale</code>.</p>
</div>
<div class="section level4">
<h4 id="b-3-ssh-config-explanation">1B.3 SSH Config Explanation<a class="anchor" aria-label="anchor" href="#b-3-ssh-config-explanation"></a>
</h4>
<p>As a quick breakdown of the above configuration options:</p>
<p>The <code>Host biostats</code> line assigns this configuration the
alias/name ‘biostats’. We can use this name when running SSH to
automatically use all of the configuration options we specified,
like:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">ssh</span> biostats</span></code></pre></div>
<p>The <code>User</code> field should be your cluster username, and
<code>Port</code> can be set to <code>22</code> (the default port for
SSH).</p>
<p>The two key elements are the <code>LocalForward</code> fields:</p>
<pre><code>    LocalForward 8895 /tmp/jupyter-&lt;your_username&gt;.sock
    LocalForward 8896 /tmp/rstudio-&lt;your_username&gt;.sock</code></pre>
<p>These options tell the SSH client to forward local traffic on these
ports to specific Unix socket paths on the cluster, allowing you to
access the running RStudio/JupyterLab jobs.</p>
<p>In this case, port <code>8895</code> will be used for JupyterLab and
port <code>8896</code> will be used for RStudio, but feel free to
customize these to any non-reserved ports you like (most ports in the
8800-8999 range should be available).</p>
<p>Once configured, save and close the file.</p>
</div>
</div>
<div class="section level3">
<h3 id="c--test-the-ssh-connection">1C. Test the SSH Connection<a class="anchor" aria-label="anchor" href="#c--test-the-ssh-connection"></a>
</h3>
<p>Now, we’ll run a quick check to verify that the SSH configuration is
working as expected.</p>
<p>First, we need to open a terminal window, which varies slightly by
platform:</p>
<table class="table">
<thead><tr class="header">
<th>OS</th>
<th>Command</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Windows</td>
<td>Search for ‘Powershell’ or ‘Command Prompt’</td>
</tr>
<tr class="even">
<td>Mac</td>
<td>Search for ‘Terminal’</td>
</tr>
</tbody>
</table>
<p>Once the terminal window is open, type:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">ssh</span> biostats</span></code></pre></div>
<p><img src="figures/CIDA_BIOS_Cluster_Interactive_IDEs/biostats_hpc_ssh_2.png" width="80%" style="display: block; margin: auto;"></p>
<p>Once you’ve logged in via SSH, open a web browser on your local
machine (but keep the SSH window open!) and enter:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">localhost:8895</span></span></code></pre></div>
<p>in the address bar. If you assigned different ports in your config
file, modify the address accordingly.</p>
<p>In the browser, you should see an error screen. This is expected.</p>
<p><img src="figures/CIDA_BIOS_Cluster_Interactive_IDEs/localhost_test.png" width="80%" style="display: block; margin: auto;"></p>
<p>Moving back to your SSH window, you should see some error messages
populate the screen:</p>
<p><img src="figures/CIDA_BIOS_Cluster_Interactive_IDEs/biostats_hpc_ssh_local_forward_test.png" width="80%" style="display: block; margin: auto;"></p>
<p>If you see these error messages in your SSH window,
Congratulations!</p>
<p>This means you’ve configured SSH correctly! The error messages appear
because the browser is attempting to connect, but there is nothing on
the other end (yet) to accept the connection.</p>
<p>These error messages will continue to appear in your SSH window as
long as you keep the <code>localhost:8895</code> browser tab open. Feel
free to close the browser tab now and type <code>clear</code> in your
SSH window to clear the messages from your terminal screen.</p>
<div class="section level4">
<h4 id="c-1-troubleshooting">1C.1 Troubleshooting<a class="anchor" aria-label="anchor" href="#c-1-troubleshooting"></a>
</h4>
<p>If you don’t see the error messages in your SSH window:</p>
<ol style="list-style-type: decimal">
<li>Make sure the <code>localhost:&lt;port&gt;</code> you’re visiting in
browser matches one of the <code>LocalForward &lt;port&gt;</code> lines
in your SSH config file.</li>
<li>Check that you’re logging in with the <code>ssh biostats</code>
alias from your SSH config file.</li>
<li>Verify that these ports aren’t being used by something else on your
machine (i.e. a local Jupyter Notebook).</li>
</ol>
</div>
</div>
<div class="section level3">
<h3 id="d--get-launch-scripts">1D. Get Launch scripts<a class="anchor" aria-label="anchor" href="#d--get-launch-scripts"></a>
</h3>
<p>To launch an RStudio/JupyterLab session, you’ll need a copy of the
<code>rstudio_helper.sh</code> and <code>jupyter_helper.sh</code>
scripts. These scripts help automate some of the setup for
RStudio/JupyterLab sessions.</p>
<p>In your SSH window, navigate to your home directory
(<code>cd ~</code>) and run:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">cp</span> /biostats_share/hillandr/containers/scripts/rstudio_helper.sh .</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">cp</span> /biostats_share/hillandr/containers/scripts/jupyter_helper.sh .</span></code></pre></div>
<p>To make copies of both scripts in your home directory
(<code>~</code>).</p>
</div>
</div>
<div class="section level2">
<h2 id="launching-an-rstudio-session">2. Launching an RStudio Session<a class="anchor" aria-label="anchor" href="#launching-an-rstudio-session"></a>
</h2>
<p>Once you have copies of the launch scripts, in your SSH window try
running:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">./rstudio_helper.sh</span></span></code></pre></div>
<p>You should see a message
<code>Submitted batch job &lt;job_id&gt;</code>. This is the Job ID for
your RStudio job, which you’ll need again when you want to shut down the
RStudio session. This ID will change each time you launch a new job.</p>
<p>Now, run <code>squeue</code>.</p>
<p>You should see an entry for your Job ID, similar to my example
below.</p>
<p><img src="figures/CIDA_BIOS_Cluster_Interactive_IDEs/biostats_hpc_rstudio_launch.png" width="80%" style="display: block; margin: auto;"></p>
<p>This job will also produce two output files
<code>rstudio_helper.out</code> and <code>rstudio_helper.err</code>
which will log outputs or errors that the system encounters.</p>
<p>If you <em>don’t</em> see your Job ID in the <code>squeue</code>
list, try inspecting the two above files for any error messages.</p>
<div class="section level3">
<h3 id="a--connect-to-rstudio">2A. Connect to RStudio<a class="anchor" aria-label="anchor" href="#a--connect-to-rstudio"></a>
</h3>
<p>If you can see your RStudio job running in <code>squeue</code>, go
back to your web browser and visit</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">localhost:8896</span></span></code></pre></div>
<p>in the address bar.</p>
<p>You should see a loading screen, and eventually the RStudio
interface!</p>
<p><img src="figures/CIDA_BIOS_Cluster_Interactive_IDEs/biostats_hpc_rstudio_interface.png" width="80%" style="display: block; margin: auto;"></p>
<p>Congratulations! You can now use RStudio on the cluster!</p>
<p>Feel free to try out the interface and verify that everything works
as expected.</p>
<p>When you’re finished, shut down the RStudio job by following the
instructions in <a href="#quit-the-rstudiojupyterlab-session">Quit the
RStudio/JupyterLab Job</a></p>
<div class="section level4">
<h4 id="a-1-troubleshooting">2A.1 Troubleshooting<a class="anchor" aria-label="anchor" href="#a-1-troubleshooting"></a>
</h4>
<p>If you <em>don’t</em> see the RStudio interface in your browser:</p>
<ol style="list-style-type: decimal">
<li>Verify that you used the correct port in the browser. (If you used
the default config, RStudio is <code>8896</code>).</li>
<li>Double check your SSH config file and make sure your
<code>LocalForward</code> directives match the template from <a href="#b-1-ssh-config-template">1B.1 SSH Config Template</a>
</li>
<li>Run <code>squeue</code> again and verify that your job is still
running. If the job is not running, check
<code>rstudio_helper.err</code> and <code>rstudio_helper.out</code> for
more information.</li>
</ol>
</div>
</div>
<div class="section level3">
<h3 id="b--customizing-the-rstudio-job">2B. Customizing the RStudio Job<a class="anchor" aria-label="anchor" href="#b--customizing-the-rstudio-job"></a>
</h3>
<p>The <code>rstudio_helper.sh</code> script essentially just automates
some cleanup tasks and submits a new <code>sbatch</code> batch script
which launches RStudio.</p>
<p>If you open <code>rstudio_helper.sh</code> and scroll down to the
<code>sbatch &lt;&lt;==SBATCH=SCRIPT==</code> section, you can customize
the parameters of the underlying SLURM job to suit your needs:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># This command redirects the rest of this script to a sbatch call.</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="ex">sbatch</span> <span class="op">&lt;&lt;==SBATCH=SCRIPT==</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="st">#!/bin/bash</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="st">#SBATCH --job-name=rstudio_helper</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="st">#SBATCH --output=rstudio_helper.out</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="st">#SBATCH --error=rstudio_helper.err</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="st">#SBATCH --exclude=csphbiostats.ucdenver.pvt</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="st">#SBATCH --mem=64G</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="st">#SBATCH --ntasks=1</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="st">#SBATCH --cpus-per-task=8</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="st"># Launch the container.</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="st">apptainer run </span><span class="dt">\</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="st">    --no-mount /etc/localtime </span><span class="dt">\</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="st">    --bind /biostats_share:/biostats_share </span><span class="dt">\</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="st">/biostats_share/hillandr/containers/rstudio.sif</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="op">==SBATCH=SCRIPT==</span></span></code></pre></div>
<p>The default <code>rstudio_helper.sh</code> script submits a job
which:</p>
<ul>
<li>Runs on any node <em>except</em> the head node
<code>--exclude=csphbiostats.ucdenver.pvt</code>
</li>
<li>Requests 8 CPU Cores <code>--cpus-per-task=8</code>
</li>
<li>Requests 64GB of RAM <code>--mem=64G</code>
</li>
</ul>
<p>You can change any of these values to meet your needs.</p>
<p>The available resources of each compute node are listed in the
article <a href="https://cida-csph.github.io/CIDAtools/articles/CIDA_BIOS_Cluster.html#csph-biostats-hpc-cluster">Computing
on the CSPH Biostats Cluster</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="launching-a-jupyterlab-session">3. Launching a JupyterLab Session<a class="anchor" aria-label="anchor" href="#launching-a-jupyterlab-session"></a>
</h2>
<p>Once you have copies of the launch scripts, try running:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">./jupyter_helper.sh</span></span></code></pre></div>
<p>You should see a message
<code>Submitted batch job &lt;job_id&gt;</code>. This is the Job ID for
your JupyterLab job, which you’ll need again when you want to shut down
the JupyterLab session. This ID will change each time you launch a new
job.</p>
<p>Now, run <code>squeue</code>.</p>
<p>You should see an entry for your Job ID, similar to my example
below.</p>
<p><img src="figures/CIDA_BIOS_Cluster_Interactive_IDEs/biostats_hpc_jupyter_launch.png" width="80%" style="display: block; margin: auto;"></p>
<p>This job will also produce two output files
<code>jupyter_helper.out</code> and <code>jupyter_helper.err</code>
which will log outputs or errors that the system encounters.</p>
<p>If you <em>don’t</em> see your Job ID in the <code>squeue</code>
list, try inspecting the two above files for any error messages.</p>
<p><strong>IMPORTANT:</strong> The first time you launch JupyterLab, it
will create a Python <code>virtualenv</code> under
<code>~/jupyterlab_env</code>. This process takes time (in my
experience, up to 10 minutes). If you are unable to connect to your
JupyterLab instance immediately after launching the job, don’t worry!
The setup process will log output to the output and error logs listed
above.</p>
<div class="section level3">
<h3 id="a--connect-to-jupyterlab">3A. Connect to JupyterLab<a class="anchor" aria-label="anchor" href="#a--connect-to-jupyterlab"></a>
</h3>
<p>If you can see your JupyterLab job running in <code>squeue</code>, go
back to your web browser and visit</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">localhost:8895</span></span></code></pre></div>
<p>in the address bar.</p>
<p>You should see a loading screen, and eventually the JupyterLab
interface!</p>
<p><img src="figures/CIDA_BIOS_Cluster_Interactive_IDEs/biostats_hpc_jupyter_interface.png" width="80%" style="display: block; margin: auto;"></p>
<p>Congratulations! You can now use JupyterLab on the cluster!</p>
<p>Feel free to try out the interface and verify that everything works
as expected.</p>
<p>When you’re finished, shut down the JupyterLab job by following the
instructions in <a href="#quit-the-rstudiojupyterlab-session">Quit the
RStudio/JupyterLab Job</a></p>
<div class="section level4">
<h4 id="a-1-troubleshooting-1">3A.1 Troubleshooting<a class="anchor" aria-label="anchor" href="#a-1-troubleshooting-1"></a>
</h4>
<p>If you <em>don’t</em> see the JupyterLab interface in your
browser:</p>
<ol style="list-style-type: decimal">
<li>Verify that you used the correct port in the browser. (If you used
the default config, JupyterLab is <code>8895</code>).</li>
<li>Double check your SSH config file and make sure your
<code>LocalForward</code> directives match the template from <a href="#b-1-ssh-config-template">1B.1 SSH Config Template</a>.</li>
<li>Run <code>squeue</code> again and verify that your job is still
running. If the job is not running, check the
<code>jupyter_helper.err</code> and <code>jupyter_helper.out</code>
files for more information.</li>
<li>If you’re launching JupyterLab for the first time, it could take up
to 10 minutes for the script to initialize the
<code>/jupyterlab_venv</code> virtual environment. If the job is running
(via <code>squeue</code>) but you can’t connect through your browser,
try waiting ~10 minutes for environment to initialize.
<ul>
<li>After the venv setup is complete, future launches of JupyterLab
through <code>./jupyter_helper.sh</code> should take only a few
seconds.</li>
</ul>
</li>
</ol>
</div>
</div>
<div class="section level3">
<h3 id="b--customizing-the-jupyterlab-job">3B. Customizing the JupyterLab Job<a class="anchor" aria-label="anchor" href="#b--customizing-the-jupyterlab-job"></a>
</h3>
<p>The <code>jupyter_helper.sh</code> script essentially just automates
some cleanup tasks and submits a new <code>sbatch</code> batch script
which launches JupyterLab.</p>
<p>If you open <code>jupyter_helper.sh</code> and scroll down to the
<code>sbatch &lt;&lt;==SBATCH=SCRIPT==</code> section, you can customize
the parameters of the underlying SLURM job to suit your needs:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">sbatch</span> <span class="op">&lt;&lt;==SBATCH=SCRIPT==</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="st">#!/bin/bash</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="st">#SBATCH --job-name=jupyter_helper</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="st">#SBATCH --output=jupyter_helper.out</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="st">#SBATCH --error=jupyter_helper.err</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="st">#SBATCH --exclude=csphbiostats.ucdenver.pvt</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="st">#SBATCH --mem=64G</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="st">#SBATCH --ntasks=1</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="st">#SBATCH --cpus-per-task=8</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="st"># Launch the container.</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="st">apptainer run </span><span class="dt">\</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="st">    --bind /biostats_share:/biostats_share </span><span class="dt">\</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="st">/biostats_share/hillandr/containers/jupyterlab.sif </span><span class="dt">\</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="st">    --notebook-dir "</span><span class="va">$HOME</span><span class="st">"</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="op">==SBATCH=SCRIPT==</span></span></code></pre></div>
<p>The default <code>jupyter_helper.sh</code> script submits a job
which:</p>
<ul>
<li>Runs on any node <em>except</em> the head node
<code>--exclude=csphbiostats.ucdenver.pvt</code>
</li>
<li>Requests 8 CPU Cores <code>--cpus-per-task=8</code>
</li>
<li>Requests 64GB of RAM <code>--mem=64G</code>
</li>
</ul>
<p>You can change any of these values to meet your needs.</p>
<p>The available resources of each compute node are listed in the
article <a href="https://cida-csph.github.io/CIDAtools/articles/CIDA_BIOS_Cluster.html#csph-biostats-hpc-cluster">Computing
on the CSPH Biostats Cluster</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="quit-the-rstudiojupyterlab-session">4. Quit the RStudio/JupyterLab Session<a class="anchor" aria-label="anchor" href="#quit-the-rstudiojupyterlab-session"></a>
</h2>
<p>When you’re finished using JupyterLab or RStudio, run:</p>
<pre><code>scancel &lt;job_id&gt;</code></pre>
<p>from your SSH window to kill the job (make sure everything is
saved!).</p>
<p>A few things to note:</p>
<ol style="list-style-type: decimal">
<li>Like other <code>sbatch</code> jobs, the RStudio/JupyterLab jobs
will continue to run after you log out of your SSH connection (you can
try this yourself!).
<ul>
<li>This means you can log out (via SSH), then log back in later and
keep using the same session.</li>
<li>Although you <em>can</em> leave RStudio/JupyterLab running, its best
to quit the session (using <code>scancel</code>) when you’re finished to
free up resources for other users.</li>
</ul>
</li>
<li>
<strong>IMPORTANT: Check for a running RStudio/JupyterLab jobs
(using <code>squeue</code>) before submitting a new one with
<code>./rstudio_helper.sh</code> or
<code>./jupyter_helper.sh</code>!!!</strong>
<ul>
<li>Submitting a second job will not work, and will likely break your
original session as well.</li>
<li>By running <code>squeue</code> you can quickly locate the Job ID of
your running <code>rstudio_helper</code> or <code>jupyter_helper</code>
Job (if one is running). You can then either cancel this job with
<code>scancel</code> or just connect through your browser and keep
working.</li>
</ul>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="quickstart-for-returning-users">5. Quickstart (for returning users)<a class="anchor" aria-label="anchor" href="#quickstart-for-returning-users"></a>
</h2>
<p>The complete process for launching a RStudio/JupyterLab instance
(once the <a href="#first-time-setup">first-time setup</a> is complete)
looks like:</p>
<ol style="list-style-type: decimal">
<li>Open a command prompt and run <code>ssh biostats</code>.
<ul>
<li>
<code>biostats</code> is the alias for
<code>csphbiostats.ucdenver.pvt</code> that we configured in the <a href="#first-time-setup">first-time setup section</a>.</li>
</ul>
</li>
<li>Check for a currently running RStudio/JupyterLab session using
<code>squeue</code>.
<ul>
<li>To reconnect to a running session, skip to step 5.</li>
<li>To cancel the existing session, use
<code>scancel &lt;job_id&gt;</code>.</li>
</ul>
</li>
<li>If no existing session is running, from your SSH terminal run either
<code>./jupyterlab_helper.sh</code> or <code>./rstudio_helper.sh</code>.
<ul>
<li>The script should exit after printing a Job ID for your new
session.</li>
</ul>
</li>
<li>Verify that your new session is running using <code>squeue</code>
and look for the Job ID.</li>
<li>Open your browser to <code>localhost:8895</code> (JupyterLab) or
<code>localhost:8896</code> (RStudio).</li>
<li>Done!</li>
</ol>
</div>
<div class="section level2">
<h2 id="conclusion">6. Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>At this point, you should be able to launch, connect to, and cancel
RStudio and JupyterLab jobs on the cluster!</p>
<p>The sections below provide some additional configuration options and
information, but these sections are completely optional.</p>
</div>
<div class="section level2">
<h2 id="optional-additional-options-and-job-customization">7. (Optional) Additional Options and Job Customization<a class="anchor" aria-label="anchor" href="#optional-additional-options-and-job-customization"></a>
</h2>
<p>This section provides some additional information and configuration
options.</p>
<div class="section level3">
<h3 id="a--apptainer-containers">7A. Apptainer Containers<a class="anchor" aria-label="anchor" href="#a--apptainer-containers"></a>
</h3>
<p>The JupyterLab and RStudio instances both run inside of Apptainer
containers.</p>
<p>Apptainer (formerly Singularity) containers are stored as
self-contained files with the <code>.sif</code> extension.</p>
<p>The benefit of hosting JupyterLab and RStudio within containers is
that they offer a consistent environment where all dependencies are
installed by default.</p>
<p>The RStudio and JupyterLab containers are derived from a <a href="https://github.com/CIDA-CSPH/Biostats-Cluster-Tools/blob/main/containers/RBase/docker/Dockerfile" class="external-link">base
container image</a> which holds installation of R, Python, and Julia
languages, along with packages/libraries to support installing most
other common R/Python libraries.</p>
<div class="section level4">
<h4 id="a-1-bind-mounts">7A.1 Bind Mounts<a class="anchor" aria-label="anchor" href="#a-1-bind-mounts"></a>
</h4>
<p>One important concept when working with containers is a ‘bind mount’.
Containers are like small Linux installations which run in a separate,
read-only filesystem. This means we cannot access any files
<em>outside</em> of the container by default.</p>
<p><em>Bind mounts</em> allow us to overlay specific parts of the host’s
filesystem onto the container, so we can read from and write our own
files (on the host system) from inside the container.</p>
<p>By default, Apptainer sets up bind mounts for a few directories
including your home directory (<code>~</code>), your working directory
(<code>.</code>) and <code>/tmp</code>.</p>
<p>The <code>jupyter_helper.sh</code> and <code>rstudio_helper.sh</code>
scripts also include an additional bind mount:</p>
<p><code>--bind /biostats_share:/biostats_share</code></p>
<p>which allows us to access the <code>/biostats_share</code> directory
from inside the container.</p>
<p>If you find yourself unable to access files from within the
container, you can add the specific directory as a bind mount by
modifying the <code>*_helper.sh</code> script to include additional bind
mounts:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># This command redirects the rest of this script to a sbatch call.</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="ex">sbatch</span> <span class="op">&lt;&lt;==SBATCH=SCRIPT==</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="st">#!/bin/bash</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="st">#SBATCH --job-name=jupyter_helper</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="st">#SBATCH --output=jupyter_helper.out</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="st">#SBATCH --error=jupyter_helper.err</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="st">#SBATCH --exclude=csphbiostats.ucdenver.pvt</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="st">#SBATCH --mem=64G</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="st">#SBATCH --ntasks=1</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="st">#SBATCH --cpus-per-task=8</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="st"># Launch the container.</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="st">apptainer run </span><span class="dt">\</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="st">    --bind /biostats_share:/biostats_share </span><span class="dt">\</span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a><span class="st">    --bind /another_special_directory:/another_special_directory </span><span class="dt">\</span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a><span class="st">/biostats_share/hillandr/containers/jupyterlab.sif </span><span class="dt">\</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a><span class="st">    --notebook-dir "</span><span class="va">$HOME</span><span class="st">" </span><span class="dt">\</span></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a><span class="st">    --venv "</span><span class="va">$HOME</span><span class="st">/my_custom_venv"</span></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a><span class="op">==SBATCH=SCRIPT==</span></span></code></pre></div>
<p>The line
<code>--bind /another_special_directory:/another_special_directory</code>
make the <code>/another_special_directory</code> path available in the
container (make sure to use an absolute path).</p>
<p>In general, bind mount arguments look like:</p>
<p><code>--bind &lt;local_directory&gt;:&lt;container_path&gt;</code></p>
<p>To mount <code>&lt;local_directory&gt;</code> path on the cluster to
<code>&lt;container_path</code> inside the container.</p>
<p>To reduce confusion, I usually mount each local path to the same path
within the container (as I did with <code>/biostats_share</code>).</p>
</div>
</div>
<div class="section level3">
<h3 id="b--jupyterlab-options">7B. JupyterLab Options<a class="anchor" aria-label="anchor" href="#b--jupyterlab-options"></a>
</h3>
<p>The JupyterLab container holds an installation of Python 3.13.</p>
<p>When launched for the first time, the container will create a new
<code>virtualenv</code> environment in your home directory at
<code>~/jupyterlab_venv</code>, which will hold all Python dependencies
(including JupyterLab itself).</p>
<div class="section level4">
<h4 id="b-1-using-an-alternative-venv-for-jupyterlab">7B.1 Using an alternative <code>venv</code> for JupyterLab<a class="anchor" aria-label="anchor" href="#b-1-using-an-alternative-venv-for-jupyterlab"></a>
</h4>
<p>Although the <code>~/jupyterlab_venv</code> is used by default, you
can specify a different virtualenv if you wish.</p>
<p>You can do this by modifying the <code>jupyter_helper.sh</code>
script and passing a value for the <code>--venv</code> parameter to the
<code>jupyter.sif</code> container.</p>
<p>The would look like:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># This command redirects the rest of this script to a sbatch call.</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="ex">sbatch</span> <span class="op">&lt;&lt;==SBATCH=SCRIPT==</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="st">#!/bin/bash</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="st">#SBATCH --job-name=jupyter_helper</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="st">#SBATCH --output=jupyter_helper.out</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="st">#SBATCH --error=jupyter_helper.err</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="st">#SBATCH --exclude=csphbiostats.ucdenver.pvt</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="st">#SBATCH --mem=64G</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="st">#SBATCH --ntasks=1</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="st">#SBATCH --cpus-per-task=8</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="st"># Launch the container.</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="st">apptainer run </span><span class="dt">\</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="st">    --bind /biostats_share:/biostats_share </span><span class="dt">\</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a><span class="st">/biostats_share/hillandr/containers/jupyterlab.sif </span><span class="dt">\</span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="st">    --notebook-dir "</span><span class="va">$HOME</span><span class="st">" </span><span class="dt">\</span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a><span class="st">    --venv "</span><span class="va">$HOME</span><span class="st">/my_custom_venv"</span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a><span class="op">==SBATCH=SCRIPT==</span></span></code></pre></div>
<p>The second-to-last line <code>--venv "$HOME/my_custom_venv"</code>
sets the path to the alternative venv.</p>
<p>If this path exists already, the launch script will attempt to
activate and use this virtual environment.</p>
<p>If the path does <em>not</em> exist, it will be created and
initialized with a default set of packages, which includes
JupyterLab.</p>
<p><strong>NOTE:</strong> If you do attempt to use an pre-existing
virtual environment, ensure that JupyterLab is installed <em>before</em>
running <code>jupyter_helper.sh</code>, as this script will fail if no
JupyterLab installation is found.</p>
</div>
<div class="section level4">
<h4 id="b-2-setting-an-alternative-home">7B.2 Setting an Alternative home<a class="anchor" aria-label="anchor" href="#b-2-setting-an-alternative-home"></a>
</h4>
<p>By default, the JupyterLab interface will use your <code>$HOME</code>
(<code>~</code>) directory as the launch directory.</p>
<p>If you wish to use a different directory, you can change the
<code>--notebook-dir</code> argument in
<code>jupyter_helper.sh</code></p>
</div>
</div>
<div class="section level3">
<h3 id="c--rstudio-options">7C. RStudio Options<a class="anchor" aria-label="anchor" href="#c--rstudio-options"></a>
</h3>
<p>The RStudio container uses an installation of R 4.5.0, which is the
latest version at the time of writing.</p>
<p>By default, the container comes with many libraries pre-installed,
including the <code>tidyverse</code> family of packages.</p>
<p>Additionally, the container has many development libraries installed,
which should allow you to compile most R packages from source if
required.</p>
<div class="section level4">
<h4 id="c-1-renv-usage">7C.1 Renv Usage<a class="anchor" aria-label="anchor" href="#c-1-renv-usage"></a>
</h4>
<p>Although the container has many libraries pre-installed, I highly
recommend using <code>renv</code> in each of your RStudio projects.</p>
<p>You can run <code>renv::init()</code> from an RStudio project to
initialize <code>renv</code>.</p>
</div>
<div class="section level4">
<h4 id="c-2-changing-the-r-version">7C.2 Changing the R Version<a class="anchor" aria-label="anchor" href="#c-2-changing-the-r-version"></a>
</h4>
<p>By default, the container uses R-4.5.0, but R-4.4.3 is also installed
for compatibility.</p>
<p>To change the version of R used when launching RStudio, you can
change the <code>R_PATH</code> variable defined in the
<code>rstudio_helper.sh</code> script:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co"># Default version of R is 4.5.0.</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co">#R_PATH="/opt/R/4.5.0/bin/R"</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="va">R_PATH</span><span class="op">=</span><span class="st">"/opt/R/4.4.3/bin/R"</span></span></code></pre></div>
<p>Changing this variable changes the path passed to the
<code>--r-path</code> argument later in the script.</p>
<p>Note that these paths are relative to the container, not to the
cluster’s filesystem.</p>
<p>Currently the only two supported paths (and versions of R) are:</p>
<table class="table">
<thead><tr class="header">
<th>Version</th>
<th>Path</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>R-4.5.0 (default)</strong></td>
<td>/opt/R/4.5.0/bin/R</td>
</tr>
<tr class="even">
<td>R-4.4.3</td>
<td>/opt/R/4.4.3/bin/R</td>
</tr>
</tbody>
</table>
<p>If you need an alternative version of R installed, open an issue in
the <a href="https://github.com/CIDA-CSPH/Biostats-Cluster-Tools/issues" class="external-link">GitHub
repository for this project</a> and I can add it to the container.</p>
</div>
</div>
<div class="section level3">
<h3 id="d--implementation-details">7D. Implementation Details<a class="anchor" aria-label="anchor" href="#d--implementation-details"></a>
</h3>
<p>If you are curious as to how the RStudio/JupyterLab interfaces are
configured, this section provides a brief explanation.</p>
<p>The challenge with running RStudio/JupyterLab on the cluster is that
the RStudio/JupyterLab server needs to run on a compute node, which is
not directly acessible (via the network) to your local machine.
Additionally, hosting a public web server on these nodes could present a
security risk.</p>
<p><img src="figures/CIDA_BIOS_Cluster_Interactive_IDEs/biostats_hpc_rstudio_diagram.png" width="80%" style="display: block; margin: auto;"></p>
<p>To facilitate a secure connection, each RStudio/JupyterLab job
creates a link between your (local) computer and the compute node
running the job via a pair of SSH tunnels.</p>
<p>The first SSH tunnel is configured locally on your machine (see the
<a href="#first-time-setup">First-time Setup</a> section above):</p>
<p>This SSH tunnel forwards any local traffic on
<code>localhost:8895</code> or <code>localhost:8896</code> to specific
Unix sockets (not ports) on the <code>csphbiostats</code> head node. We
use Unix sockets for this since they:</p>
<ol style="list-style-type: decimal">
<li>Allow for file-like permissions (i.e. the socket is created and
owned by your user, and cannot be accessed by others).</li>
<li>Since Unix sockets are exposed as file-like objects, we can enforce
unique naming (each Unix socket uses the user’s name as part of the
socket path) to prevent port conflicts.</li>
</ol>
<p>The second SSH tunnel is opened by the RStudio/JupyterLab job on the
compute node. Once the job begins executing on the compute node, the
RStudio/JupyterLab launch script will:</p>
<ol style="list-style-type: decimal">
<li>Launch an RStudio/JupyterLab instance advertised on a Unix socket
(again, we use Unix sockets instead of ports for the reasons listed
above).</li>
<li>Open a background SSH tunnel to the <code>csphbiostats</code> node,
which forwards all traffic on the <code>csphbiostats</code>’s Unix
socket to the compute node’s Unix socket (which is hosting the
JupyterLab/RStudio instance).</li>
</ol>
<p>In order for this to work seamlessly, the compute node needs to be
able to SSH into the head node without prompting for a password. The
launch script takes care of this by generating a SSH keypair (located at
<code>~/.ssh/cluster_rsa</code>) which the compute node may use to log
in to the head node.</p>
<p>Together, these two SSH tunnels form a connection between your
browser visiting <code>localhost:8895</code> or
<code>localhost:8896</code> and the RStudio/JupyterLab instance running
on the compute node.</p>
<p>In summary, the container’s launch script will:</p>
<ol style="list-style-type: decimal">
<li>Check if the SSH keypair <code>~/.ssh/cluster_rsa</code> exists.
<ul>
<li>If not, the launch script will automatically create this keypair and
use it for future job launches.</li>
</ul>
</li>
<li>Check if your job is running on the head node
<code>csphbiostats</code> or a compute node (any node which is not
<code>csphbiostats</code>)
<ul>
<li>In the event that the job is running on <code>csphbiostats</code>,
we don’t need the second SSH tunnel, as your local machine will already
forward traffic directly to the configured Unix socket.</li>
</ul>
</li>
<li>Launch the RStudio/JupyterLab instance.</li>
</ol>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by CIDA Research Tools Committee.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
